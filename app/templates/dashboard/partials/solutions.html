<section class="panel">
  <div class="panel-title">Recent Solves</div>
  {% if solutions %}
  <ul class="list">
    {% for s in solutions %}
      <li>
        <span class="pill {{ 'good' if s.success else 'bad' }}">{{ 'ok' if s.success else 'fail' }}</span>
        {{ s.target or s.path | default('') }}
        <span class="muted">RA {{ '%.4f'|format(s.ra_deg or 0) }} Dec {{ '%.4f'|format(s.dec_deg or 0) }}</span>
        {% if s.uncertainty_arcsec %}<span class="muted">RMS {{ '%.2f'|format(s.uncertainty_arcsec) }}"</span>{% endif %}
        {% if s.snr %}<span class="muted">SNR {{ '%.1f'|format(s.snr) }}</span>{% endif %}
        {% if s.mag_inst %}<span class="muted">Mag {{ '%.2f'|format(s.mag_inst) }}</span>{% endif %}
        {% if s.flags %}<span class="pill warn">{{ s.flags }}</span>{% endif %}
        <span class="muted">{{ s.solved_at }}</span>
        {% if s.capture_id %}
        <button class="ghost" hx-post="/api/astrometry/solve" hx-vals='{"capture_id": {{ s.capture_id }} }' hx-target="closest section" hx-swap="outerHTML">Re-run</button>
        <button class="ghost" hx-post="/api/astrometry/report" hx-vals='{"measurement_ids":[{{ s.measurement_id or "" }}], "format":"ADES"}'>Report</button>
        {% endif %}
      </li>
    {% endfor %}
  </ul>
  {% else %}
    <div class="muted">No solves yet.</div>
  {% endif %}
</section>

<section class="panel">
  <div class="panel-title">Submissions</div>
  {% if submissions %}
  <ul class="list">
    {% for sub in submissions %}
      <li>
        <span class="pill {% if sub.status in ['failed', 'error'] %}bad{% elif sub.status in ['acked', 'sent'] %}good{% else %}warn{% endif %}">{{ sub.status }}</span>
        <strong>#{{ sub.id }}</strong>
        <span class="muted">{{ sub.channel }}</span>
        {% if sub.report_path %}<span class="muted">{{ sub.report_path }}</span>{% endif %}
        <span class="muted">{{ sub.created_at }}</span>
      </li>
    {% endfor %}
  </ul>
  {% else %}
    <div class="muted">No submissions yet.</div>
  {% endif %}
</section>

<section class="panel">
  <div class="panel-title">KPIs</div>
  {% set solved_total = kpis.solved_per_day.values() | sum %}
  {% set submissions_total = kpis.submissions_per_day.values() | sum %}
  <ul class="list">
    <li>Solves (7d): {{ solved_total }}</li>
    <li>Submissions (7d): {{ submissions_total }}</li>
  </ul>
  {% if kpis.solved_per_day %}
    <div class="muted tiny">Solves per day: {{ kpis.solved_per_day }}</div>
  {% endif %}
  {% if kpis.submissions_per_day %}
    <div class="muted tiny">Submissions per day: {{ kpis.submissions_per_day }}</div>
  {% endif %}
</section>
