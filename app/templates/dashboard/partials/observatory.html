<div class="panel-title">Observatory Configuration</div>
<p class="panel-description">
  Site configuration is managed via environment variables.
</p>

{% if site %}
<div class="snapshot-grid">
  <!-- Site Location Card -->
  <div class="snapshot-card">
    <div class="snapshot-label">Site Location</div>
    <div class="snapshot-value">
      {{ "%.4f"|format(site.latitude) if site.latitude is not none else "â€”" }}Â° N /
      {{ "%.4f"|format(site.longitude) if site.longitude is not none else "â€”" }}Â° E
    </div>
    <div class="snapshot-meta">
      Altitude {{ "%.0f"|format(site.altitude_m) if site.altitude_m is not none else "â€”" }} m
    </div>
  </div>

  <!-- Sky Quality Card -->
  <div class="snapshot-card">
    <div class="snapshot-label">Sky Quality</div>
    <div class="snapshot-value">Bortle {{ site.bortle if site.bortle is not none else "â€”" }}</div>
    <div class="snapshot-meta">
      {{ "Dark suburban skies" if site and site.bortle and site.bortle <= 5 else "Light polluted skies" }} </div>
    </div>

    <!-- Weather & Horizon Card -->
    <div class="snapshot-card">
      <div class="snapshot-label">Weather & Horizon</div>
      {% if weather_summary %}
      <div class="weather-metrics">
        <span>{{ weather_summary.temperature_c if weather_summary.temperature_c is not none else "â€”" }}Â°C</span>
        <span>{{ weather_summary.wind_speed_mps if weather_summary.wind_speed_mps is not none else "â€”" }} m/s
          wind</span>
        <span>{{ weather_summary.cloud_cover_pct if weather_summary.cloud_cover_pct is not none else "â€”" }}%
          clouds</span>
        <span>{{ weather_summary.precipitation_probability_pct if weather_summary.precipitation_probability_pct is not
          none else "â€”" }}% rain</span>
      </div>
      <div class="snapshot-meta">
        <span class="weather-pill {{ 'good' if weather_summary.is_safe else 'warn' }}">
          {{ "Clear" if weather_summary.is_safe else "Blocked" }}
        </span>
        {% if weather_summary.reasons %}
        {{ weather_summary.reasons | join(', ') }}
        {% else %}
        Conditions within limits
        {% endif %}
        <div class="muted tiny">
          Updated {{ weather_summary.fetched_at.strftime("%H:%M UTC") }}
        </div>
      </div>
      <div class="snapshot-meta" style="margin-top: 8px;">
        <button class="btn-toggle {{ 'active' if ignore_weather else '' }}"
          hx-post="/dashboard/observatory/ignore_weather"
          hx-vals='{"ignore": {{ "false" if ignore_weather else "true" }}}' hx-target="closest section"
          hx-swap="innerHTML">
          {{ "âš ï¸ Weather Check Ignored" if ignore_weather else "ğŸ›¡ï¸ Weather Check Active" }}
        </button>
      </div>
      {% else %}
      <div class="snapshot-value">Weather feed unavailable</div>
      {% endif %}

      <div class="snapshot-meta" style="margin-top: 12px; border-top: 1px solid var(--border-color); padding-top: 8px;">
        Horizon {{ "loaded" if site.horizon_mask_json else "missing" }}
        {% if site.horizon_mask_json %}
        <div class="muted tiny">
          {{ site.horizon_mask_json|length }} points from PVGIS
        </div>
        {% endif %}
      </div>

      <div class="snapshot-meta" style="margin-top: 8px;">
        <button type="button" class="btn-secondary small" hx-post="/site/{{ site.name }}/horizon/refresh"
          hx-target="closest section" hx-swap="outerHTML">
          ğŸ”„ Refresh Horizon
        </button>
      </div>

      <div class="snapshot-meta" style="margin-top: 8px;">
        <span class="sensor-pill">
          Open-Meteo
          <span class="sensor-meta">Â· Auto-configured</span>
        </span>
      </div>
    </div>
  </div>
  {% else %}
  <div class="empty-state-small">
    <div class="muted">No site details configured. Check your .env file.</div>
  </div>
  {% endif %}