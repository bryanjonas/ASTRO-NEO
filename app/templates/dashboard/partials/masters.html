<div class="panel-title small">Master Calibration Frames</div>
<div class="panel-description">Upload bias/dark/flat masters and select which ones to use.</div>

<div class="master-grid">
  {% for t in ["bias", "dark", "flat"] %}
    <div class="master-card">
      <div class="panel-title small">{{ t|capitalize }}</div>
      <form hx-post="/dashboard/masters/upload" hx-target="closest .subpanel" hx-swap="innerHTML" enctype="multipart/form-data">
        <input type="hidden" name="cal_type" value="{{ t }}">
        <input type="file" name="file" accept=".fits,.fit,.fts" class="file-input">
        <button type="submit" class="btn-secondary">Upload</button>
      </form>
      {% if existing.get(t) %}
        <div class="muted tiny">Available masters:</div>
        <ul class="list">
          {% for p in existing.get(t) %}
            <li>
              <form hx-post="/dashboard/masters/select" hx-target="closest .subpanel" hx-swap="innerHTML">
                <input type="hidden" name="cal_type" value="{{ t }}">
                <input type="hidden" name="path" value="{{ p }}">
                <button type="submit" class="ghost-small {% if selected.get(t)==p %}selected{% endif %}">{{ p.split('/')[-1] }}</button>
              </form>
            </li>
          {% endfor %}
        </ul>
      {% else %}
        <div class="muted tiny">No masters uploaded yet.</div>
      {% endif %}
      {% if selected.get(t) %}
        <div class="pill good">Selected: {{ selected.get(t).split('/')[-1] }}</div>
      {% endif %}
    </div>
  {% endfor %}
</div>
