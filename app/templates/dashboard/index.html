{% extends "base.html" %}
{% block content %}
<div class="tabs" x-data="{ tab: 'overview' }">
  <nav class="tab-nav">
    <button :class="{active: tab==='overview'}" @click="tab='overview'">Overview</button>
    <button :class="{active: tab==='observatory'}" @click="tab='observatory'">Observatory</button>
    <button :class="{active: tab==='equipment'}" @click="tab='equipment'">Equipment</button>
    <button :class="{active: tab==='targets'}" @click="tab='targets'">Targets</button>
    <button :class="{active: tab==='exposures'}" @click="tab='exposures'">Exposures</button>
    <button :class="{active: tab==='reports'}" @click="tab='reports'">Reports</button>
  </nav>

  <section x-show="tab==='overview'" class="panel" hx-get="/dashboard/partials/status" hx-trigger="revealed, every 8s" hx-target="this" hx-swap="innerHTML">
    <div class="panel-title">Status</div>
    <div class="muted">Loading...</div>
  </section>

  <section x-show="tab==='observatory'" class="panel" hx-get="/dashboard/partials/observatory" hx-trigger="revealed, every 30s" hx-target="this" hx-swap="innerHTML">
    <div class="panel-title">Observatory</div>
    <p class="muted">Loading observatory snapshot...</p>
  </section>

  <section x-show="tab==='equipment'" class="panel" hx-get="/dashboard/partials/equipment" hx-trigger="revealed, every 30s" hx-target="this" hx-swap="innerHTML">
    <div class="panel-title">Equipment</div>
    <p class="muted">Loading equipment profile...</p>
  </section>

  <section x-show="tab==='targets'" class="panel" hx-get="/dashboard/partials/targets" hx-trigger="revealed, every 20s" hx-target="this" hx-swap="innerHTML">
    <div class="panel-title">Targets</div>
    <p class="muted">Loading targets...</p>
  </section>

  <section x-show="tab==='exposures'" class="panel">
    <div class="panel-title">Exposures & Session</div>
    <div class="actions">
      <button hx-post="/api/session/start" hx-trigger="click" class="ghost">Start Session</button>
      <button hx-post="/api/session/calibration/run" hx-trigger="click" class="ghost">Run Calibrations</button>
      <button hx-post="/api/session/calibration/reset" hx-trigger="click" class="ghost">Reset Calibrations</button>
    </div>
    <div class="subpanel" hx-get="/dashboard/partials/exposure_config" hx-trigger="revealed" hx-target="this" hx-swap="innerHTML">
      <div class="muted">Exposure configuration loading...</div>
    </div>
    <div class="subpanel" hx-get="/api/session/status" hx-trigger="revealed, every 10s" hx-target="this" hx-swap="innerHTML">
      <div class="muted">Session status loading...</div>
    </div>
    <div class="subpanel" hx-get="/dashboard/partials/captures" hx-trigger="revealed, every 12s" hx-target="this" hx-swap="innerHTML">
      <div class="muted">Captures loading...</div>
    </div>
    <div class="subpanel" hx-get="/dashboard/partials/solutions" hx-trigger="revealed, every 15s" hx-target="this" hx-swap="innerHTML">
      <div class="muted">Astrometry solves loading...</div>
    </div>
    <div class="subpanel">
      <div class="panel-title small">Retention</div>
      <div hx-get="/api/retention/status" hx-trigger="revealed, every 30s" hx-target="#retention-summary" hx-swap="innerHTML">
        <div id="retention-summary" class="muted">Checking retention...</div>
      </div>
      <button hx-post="/api/retention/prune" hx-vals='{"dry_run":true}' class="ghost">Dry-Run Prune</button>
    </div>
  </section>

  <section x-show="tab==='reports'" class="panel" hx-get="/dashboard/partials/reports" hx-trigger="revealed, every 25s" hx-target="this" hx-swap="innerHTML">
    <div class="panel-title">Reports</div>
    <p class="muted">Loading reports...</p>
  </section>
</div>
{% endblock %}
